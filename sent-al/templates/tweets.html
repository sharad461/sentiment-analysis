{% extends 'layout.html' %}
{% block text %}
<div class ="main-content">
	<form id="kw-form">
		{{ form.hidden_tag() }}
		{{ form.keyword.label() }}
		{{ form.keyword() }}
		{{ form.submit() }}
	</form>
</div><div id="chartContainer" style="height: 300px; width: 100%;"></div><button id="stream-control">Pause</button><div id="tweet-log"></div>{% endblock %}{% block javascript %}<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.slim.js"></script><script src="{{url_for('static', filename="canvasjs.min.js" )}}"></script><script>
	var xValue = 0;
	var dataPoints = [];
	var chart = new CanvasJS.Chart("chartContainer", {
		theme: "light2",
		title: {
			text: "Live Data"
		},
		data: [{
			type: "line",
			dataPoints: dataPoints
		}],
		axisY:{
			maximum:1.2,
			minimum:-1.2
		}
	});

	function addData(data) {
		dataPoints.push({x: data[0][0], y: (data[0][1])});
		xValue++;
		yValue = (data[0][1]);
		chart.render();
	}

	var socket = io.connect('//' + document.domain + ':' + location.port);

	socket.on('new tweet', res => {
		append = '<br><span>' + xValue + ': '+ res.tweet +'</span>'
		tweetLog = document.querySelector("#tweet-log")
		content = tweetLog.innerHTML
		tweetLog.innerHTML = append + content
		addData([[xValue, res.polarity]])

	})

	document.querySelector("#stream-control").onclick = ()=> {
		control = document.querySelector("#stream-control")
		if(control.innerHTML == "Pause") {
			socket.emit('stop-stream', {'s':1})
			control.innerHTML = "Continue"
		} else if(control.innerHTML == "Continue") {
			socket.emit('continue-stream', {'s':1})
			control.innerHTML = "Pause"
		}
	}

	document.querySelector("#kw-form #submit").onclick = ()=>{document.location.href="/analyze/tweets/"+ document.querySelector("#keyword").value; return false}
</script>
{% endblock %}